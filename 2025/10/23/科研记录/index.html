<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>科研记录 | xmdjy's blog</title><meta name="author" content="xmdjy"><meta name="copyright" content="xmdjy"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="我也不知道会写啥。。">
<meta property="og:type" content="article">
<meta property="og:title" content="科研记录">
<meta property="og:url" content="https://xmdjy.github.io/2025/10/23/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="xmdjy&#39;s blog">
<meta property="og:description" content="我也不知道会写啥。。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xmdjy.github.io/img/tx.png">
<meta property="article:published_time" content="2025-10-23T11:19:00.000Z">
<meta property="article:modified_time" content="2025-10-25T17:04:11.516Z">
<meta property="article:author" content="xmdjy">
<meta property="article:tag" content="记录">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xmdjy.github.io/img/tx.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "科研记录",
  "url": "https://xmdjy.github.io/2025/10/23/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95/",
  "image": "https://xmdjy.github.io/img/tx.png",
  "datePublished": "2025-10-23T11:19:00.000Z",
  "dateModified": "2025-10-25T17:04:11.516Z",
  "author": [
    {
      "@type": "Person",
      "name": "xmdjy",
      "url": "https://xmdjy.github.io"
    }
  ]
}</script><link rel="shortcut icon" href="/img/icon.png"><link rel="canonical" href="https://xmdjy.github.io/2025/10/23/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin=""/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&amp;display=swap" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '科研记录',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;700&display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css"><link rel="stylesheet" href="/css/custom.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/14.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/14.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">xmdjy's blog</span></a><a class="nav-page-title" href="/"><span class="site-name">科研记录</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">科研记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-10-23T11:19:00.000Z" title="发表于 2025-10-23 19:19:00">2025-10-23</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-10-25T17:04:11.516Z" title="更新于 2025-10-26 01:04:11">2025-10-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%A7%91%E7%A0%94/">科研</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>16分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h2 id="think-then-react"><a href="#think-then-react" class="headerlink" title="think-then-react"></a>think-then-react</h2><p>pipeline：<br>下面按时间顺序把 TTR 的整条流水线串起来，从数据进入到在线推理与评测，一步连一步地说明各环节做了什么与为何这样设计。</p>
<p>阶段一：数据预处理与统一离散表示。对每一段两人互动序列，先在绝对坐标系提取每个人骨盆中心的水平位置 x、z 与朝向 r，并将其量化为离散空间符号，例如<x15><z07><r03>。随后把整段动作归一化到原点、面向正 z，使后续的姿态编码专注于自我中心的肢体运动。在姿态通道，使用一个 VQ‑VAE 把包含关节位置、旋转、速度与足底接触等连续特征，下采样后量化为离散“姿态token”&lt;p·&gt;序列；对每段动作或反应，最终形成“空间前缀token+姿态token流”的统一序列表示。这样，几何“在哪里&#x2F;朝哪儿”交由空间token承载，“如何动”交由姿态token承载，二者都变成“LLM可读”的符号。</p>
<p>阶段二：统一模型与多任务预训练。以扩展词表的序列到序列语言模型为主干，把文本、空间token与姿态token放进同一上下文里联合建模。三类预训练任务彼此交织：其一是运动—文本双向建模，用动作&#x2F;反应token生成互动描述，反向从描述生成动作&#x2F;反应token，并随机丢弃反应侧以逼近“无提示”的真实场景；其二是姿态—空间双向建模，从“当前空间+姿态”预测下一步空间，或用相邻两步空间补出中间姿态，让模型显式学会“姿态引发的位姿转移”；其三是运动—运动补全，用“动作前半+反应后半”（或反之）去补全另一半，直接灌输两人的相对时序耦合。训练是非因果的、带随机遮盖与片段裁剪，并混入单人动作—文本数据以扩展覆盖。</p>
<p>阶段三：因果微调为“先思考、再反应”。切换到自回归因果训练，分两条支线同步优化。思考支线从“正在发生的对方动作片段”生成互动&#x2F;反应的自然语言描述，面向早期语义不明确的现实，设计了“周期性重思考”，在推理时每隔 Nr 个动作token基于最新观测重写语义提示。反应支线用“动作token流+最新语义提示+自身已生成的反应历史”去逐步生成反应token，训练初期以真值描述作教师强制，描述质量收敛后再切换为使用模型自己写出的描述，弥合训练—推理不一致。</p>
<p>阶段四：在线推理与实时循环。系统以固定帧率接入对方的动作流，增量地编码为空间&#x2F;姿态token。每到一个新时间步，若到了重思考间隔，就用到目前为止的动作片段重写语义提示；随后在相同上下文下自回归地产生本步反应姿态token，并通过姿态—空间映射推进自身的空间状态；把离散token通过 VQ‑VAE 解码回连续骨架，输出当前帧反应。语义提示决定“做什么”，空间&#x2F;姿态token与因果解码共同落实“何时、何处、如何对接”。实测在 Nr≈4（约0.5秒）时兼顾稳定性与延迟，单步推理低于 50ms，可实时。</p>
<p>阶段五：评测与匹配模型。客观评测需要一个对互动语义敏感、又不过度依赖已知动作的匹配器。作者训练了一个“互动—文本”匹配模型，并把对方动作强力下采样到 1 FPS 后与生成反应拼接再送入匹配，以提升对反应质量的敏感度。据此计算 R‑Precision、动作类别识别准确率、FID、与文本的多模态距离与多样性等指标；同时做用户偏好测试评估主观质量。</p>
<p>这条 pipeline 的关键在于两个“耦合点”。其一是离散表示层面把“语义—几何—姿态”三种信息统一为同一种序列符号，让语言模型天然跨模态地“看见”空间与动作。其二是在推理循环里，把“思考得到的语义提示”与“动作与反应token历史”在每个时间步共同作为条件，由语义决定策略，由几何与因果历史锁定时机与位置，从而在无外部提示、在线不确定的互动里，既能消除语义歧义，又能把对接节奏对齐。</p>
<p>有关于文本的部分：<br>你的直觉没错：只用动作序列也能训练一个“动作→反应”的模型，TTR 里就做了这个对照实验。但这篇工作把“语义文本”作为中间变量，不只是“提示”，而是把原问题分解成“先判别意图、再依据意图生成反应”的两步，从建模和误差控制上都更稳。</p>
<p>从建模角度，可以把原来的条件分布写成一个含语义隐变量的分解：<br>$$<br>P(\text{Reaction}\mid \text{Action}) ;&#x3D;; \sum_{\text{Intent}} P(\text{Intent}\mid \text{Action}<em>{1:t}) \cdot P(\text{Reaction}\mid \text{Action}</em>{1:t}, \text{Intent}).<br>$$<br>这里的 Intent 就是“思考”阶段用自然语言写出来的那句描述。它把“握手&#x2F;击掌”这类早期极易混淆的交互语义显式化，等价于给反应生成器加了一个离散门控，减少让生成器“一边识别意图一边出动作”的负担。TTR 进一步每隔 Nr 帧重思考，用最新观测更新 $P(\text{Intent}\mid \cdot)$，像在在线贝叶斯里做后验更新，能压住长程漂移。</p>
<p>从几何与时序对齐角度，文本不负责坐标级控制，它承担“做什么”的决策锚点；“何时、何处、如何对接”仍由空间&#x2F;姿态token和因果式逐步解码来落实。也就是说，文本把语义歧义收敛到正确模式，空间token把对接的位置与朝向收敛到正确轨道，两者分工明确、相互补强。</p>
<p>从数据与训练角度，语义作为中间层还有三点实际收益。第一，它让“教师强制”更有效：预训练与微调早期可以用真值描述监督，先把“会不会做对的那件事”学扎实，再逐步切到自生成描述，减小训练—推理分布漂移。第二，它把单人与多人的数据打通：大量单人“动作↔文本”样本能通过这条语义通道迁移到交互生成上。第三，它带来可解释与可控性：需要时可以外插或编辑那句描述，直接引导反应风格与礼仪程度等。</p>
<p>论文里有直接的量化对比来回答“只靠动作行不行”。在相同设置下，去掉“思考”（只用动作token直接生成反应）的消融，FID 从约 1.942 恶化到约 3.828，Top‑1 排序从约 0.423 降到约 0.367，交互类别识别准确率从约 0.318 掉到约 0.230（见 <a target="_blank" rel="noopener" href="https://arxiv.org/abs/2503.16451">https://arxiv.org/abs/2503.16451</a> 的表1）。此外，用户偏好实验也显示，交互越长，带语义的 TTR 相比“纯动作直译”优势越明显，因为重思考能持续纠偏、避免前面一步的误判在后面被放大。</p>
<p>因此，文本并不是“可有可无的提示”，而是把难题显式地“分而治之”的关键中间变量。纯动作模型能工作，但在早期歧义、长时程稳定性、跨数据集迁移与人类可控性上都会吃亏；TTR 用“语义瓶颈+几何通道+因果自回归+周期性重思考”的组合，把这些短板系统性补上了。</p>
<p>动作对齐：<br>可以把“动作对齐”拆成两件事：时序对齐和几何对齐。TTR 同时利用监督对齐、显式的空间通道、以及因果式自回归，把两者拧在一起。</p>
<p>首先在时序对齐上，数据集中两人的动作与反应是逐帧对齐的，帧率统一。微调阶段采用因果训练，直接以第 t 帧的动作上下文监督预测第 t 帧的反应姿态token，也就是最小化<br>$$<br>\mathcal{L} &#x3D; -\sum_t \log P\big(b_t^{\ast}\ \big|\ A_{1:t},\ B_{1:t-1},\ \text{Intent}_k,\ S^{\text{act}}<em>0,\ S^{\text{reac}}<em>0\big),<br>$$<br>其中 $b_t^{\ast}$ 是真值反应token。因为监督目标在时间轴上逐帧给定，模型学到的条件分布天然把反应的相位“锁”在对方动作的相位附近；推理时同样按帧自回归<br>$$<br>\hat b_t \sim P(\cdot\mid A</em>{1:t},\ \hat B</em>{1:t-1},\ \text{Intent}_k,\ S^{\text{act}}_0,\ S^{\text{reac}}_0),<br>$$<br>所以时间上不会漂离已观察到的动作节奏。周期性重思考只在每 Nr 帧更新一次 Intent，避免语义层频繁抖动带来相位噪声，也能在证据充分时纠正早期误判，进一步稳住长程对齐。</p>
<p>其次在几何对齐上，TTR 不把“对接位置”塞进文本，而是用独立的绝对空间通道和“姿态→空间”的运动学学习来落地。两个人的起始全局位置和朝向被量化为空间token作为序列前缀，姿态token则是自我中心的肢体状态与根部速度等。预训练里有两个关键的姿态—空间任务：给定“当前空间+姿态”预测下一步空间，或者给定相邻两步空间补出中间姿态。它们让模型学会了一个内隐的位姿推进函数，可以抽象地写成<br>$$<br>S^{\text{reac}}<em>{t+1} \approx S^{\text{reac}}</em>{t} + g(,b_t,),<br>$$<br>即由本帧反应姿态决定自身的平移与朝向微分。这样，反应的根部位姿会随着肢体动作自然前进、后退或侧移，与对方动作的全局轨迹在空间上“跟随”起来，而不是只在原地做手势。再叠加语义Intent把“做什么”固定为“握手”“击掌”“拥抱”等模式，模型在训练数据里看到的这些模式都对应稳定的相对位姿与接触时机，于是会选择那些能把双手距离缩小到合理范围、肩身对齐朝向的姿态与根部推进，从而在空间上完成对接。</p>
<p>第三，有一个专门加强两人耦合的“运动—运动”预训练：用“动作前半+反应后半”（或反过来）去补全另一半。这等价于在不同时间片强行对齐两条轨迹，让模型学会“对方做到哪儿时，我该在几帧内到哪儿”，把相对时序关系学成一种可泛化的配合策略，而不是死记某个整段模板。</p>
<p>最后，这种对齐是“软对齐”而不是硬约束。量化的姿态token与基于序列的交叉熵训练，会把统计上最常见、最稳定的几何关系学出来，例如击掌前双方会各自抬臂并微前探，握手时前伸幅度较低且身体轻微前倾。但它没有显式的手掌—手掌距离损失或物理约束，因此毫米级、帧级严格接触并不被保证。论文通过独立的空间通道、姿态—空间耦合学习、逐帧因果监督与周期性重思考，显著减少时序漂移与空间跑偏；若在应用中需要更硬的对接，可在此之上再添加接触&#x2F;距离损失、逆运动学或轻量物理校正。论文与项目页在此，便于对照细节：<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2503.16451">https://arxiv.org/abs/2503.16451</a> 与 <a target="_blank" rel="noopener" href="https://think-then-react.github.io/%E3%80%82">https://Think-Then-React.github.io/。</a></p>
<p>StreamForest<br>pipeline：<br>这里用流程化的叙述把 StreamForest 的端到端 pipeline 串起来（以论文本身为准：<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2509.24871%EF%BC%89%E3%80%82">https://arxiv.org/abs/2509.24871）。</a></p>
<p>视频以 1 FPS 连续到达后，首先经视觉编码器与投影器被映射为一批视觉 token；系统立即把这些 token 分流到两条并行路径：一条是“精细时空窗口”（FSTW）以高保真刻画当前时刻及最近若干秒的细粒度动态，另一条是“持久事件记忆森林”（PEMF）以事件为单位组织与压缩更长时间尺度的历史。</p>
<p>在 FSTW 路径中，当前帧保留较高分辨率的空间 token 并编码时空位置信息；随着新帧不断到来，较旧的帧会在空间维度上被压缩转存为“短期时空记忆”，系统同时在这个短窗内计算相邻帧间的相似度曲线，用其局部极小值来切分出“元事件”（meta‑events），每个元事件聚合相似的连续帧 token，既保留近因的动作细节（比如小幅姿态变化、速度&#x2F;接近度变化），又把可直接离线的冗余压下来。当短期记忆超过容量或形成新的元事件时，这些元事件会被“卸载”到长期记忆端。</p>
<p>在 PEMF 路径中，来自 FSTW 的元事件被作为叶节点插入到一组按时间生长的事件树中；为保证整体视觉 token 不超过给定预算 Lq，PEMF在每次插入或预算超限时，对相邻事件节点计算综合代价并执行自适应合并。综合代价由三项惩罚加权得到：内容相似度惩罚 $Ps$ 鼓励合并视觉上高度相似的相邻事件（用双向匹配取 Top‑K token 对相似度的均值），合并计数惩罚 $Pm$ 抑制某些节点被过度多轮合并导致细节退化，时间距离惩罚 $Pt$ 倾向优先保留离查询时刻更近的细节并更激进地压缩久远历史；总体分数为 $P &#x3D; w_s Ps + w_m Pm + w_t Pt$（默认权重 0.4&#x2F;0.4&#x2F;0.2）。系统总是选择 $P$ 最小的相邻节点对，采用 ToMe 式 token 合并把两者 token 压到约一半，同时用“按 token 数加权平均”的方式更新新节点的时间戳并累加合并计数。如此循环，PEMF把长时历史组织成层级化的事件森林，既去除了局部冗余，又保留了关键的事件级证据链。</p>
<p>当任意时刻发生用户查询（时间 $t_q$）时，系统从两条路径聚合上下文：FSTW 提供当前帧的高分辨率 token 加上短期时空记忆中的压缩 token，PEMF 提供各棵事件树的根节点 token；这些视觉 token 与文本一起送入多模态 LLM，完成答案生成或未来风险&#x2F;行为前瞻等推理。查询完毕后，流式循环继续：新帧进入、FSTW 更新、产生新的元事件并插入&#x2F;触发 PEMF 的自适应合并；由于 Lq 对视觉 token 设定了硬上限，计算与显存随视频时长基本保持稳定，从而支撑长时间不间断的在线动作理解与前瞻预测。</p>
<p>森林更新规则<br>下面只讲 StreamForest 的“持久事件记忆森林（PEMF）”本体：它长什么样、节点长什么样、以及新节点如何加入并触发合并。为方便核对，术语与公式均对应论文原文（<a target="_blank" rel="noopener" href="https://arxiv.org/abs/2509.24871%EF%BC%89%E3%80%82">https://arxiv.org/abs/2509.24871）。</a></p>
<p>PEMF 的结构可以理解为“按时间顺序生长的一组事件树”，因此称作森林而不是单棵树。叶子对应从精细时空窗口（FSTW）切出的“元事件”，内部节点对应两个相邻事件经一次合并后的更高层级事件表示。森林中的每一棵树覆盖时间轴上的一个连续区间；各树的根节点共同构成“长期记忆前沿”，查询时就是把这些根节点的视觉表示与 FSTW 的近因细节一起喂入 LLM。这样做保持了两条不变性：所有节点都带有清晰的时间区间，且根节点两两互不重叠、按时间从早到晚有序排列，因而森林是对整段历史的“分段层级摘要”。</p>
<p>节点的数据结构至少包含四类信息。第一，视觉token集合及其维度（来自多帧聚合或合并之后的token）；第二，时间戳与时间跨度：时间戳用于度量该节点的“位于整段历史的何处”，论文采用按token数加权的时间均值来避免多轮合并后的漂移，公式为<br>$$<br>t_{\mathrm{new}}&#x3D;\frac{t_i n_i + t_j n_j}{n_i+n_j},<br>$$<br>其中 $n_i,n_j$ 是子节点 token 数。第三，历史合并计数 $c$，用于记录该节点在层级化压缩中“被动参与”的次数，以辅助抑制过度合并导致的细节退化。第四，关于相似度或统计量的缓存，用于快速评估与相邻节点的合并代价（实现上是否缓存属于工程自由度，文中只规定了代价的计算方式）。</p>
<p>新节点的加入是严格按时间顺序进行的。当 FSTW 在短窗内检测到一个元事件边界时，会把这一段连续帧聚合成一份紧凑表示，作为“单节点小树”附加到森林的末尾。此时森林的根节点序列等价于“当前可见的顶层事件分段”序列，新增的单节点会作为最新的一个根加入序列。加入后立即执行预算检查：若森林内所有根节点的 token 总量不超过长期记忆上限 $L_q$（由总预算扣除 FSTW 固定配额得到），就不做任何改动；一旦超过 $L_q$，就启动一轮或多轮相邻合并，直到总量回到预算之内。</p>
<p>合并只发生在时间相邻的节点对之间，以避免跨段融合破坏时间连续性。对于每一对相邻根节点 $(x_i, x_{i+1})$，系统计算一个加权代价<br>$$<br>P(x_i,x_{i+1}) ;&#x3D;; w_s,P_s ;+; w_m,P_m ;+; w_t,P_t,<br>$$<br>并总是选择 $P$ 最小的那一对优先合并。三项子代价分别刻画“内容冗余”“合并疲劳”“时间远近”的权衡：相似度惩罚 $P_s$ 倾向合并视觉上高度相似的相邻片段，计算上把两节点的 token 视作二部图两侧，取 Top‑K 余弦相似度的平均再做 $1-$ 变换得到<br>$$<br>P_s ;&#x3D;; 1 - \frac{1}{k}\sum_{(p,q)\in \mathrm{TopK}} \mathrm{sim}(X_i^{(p)},X_{i+1}^{(q)}).<br>$$<br>合并计数惩罚 $P_m$ 用于抑制某个节点被频繁压缩导致的信息流失，采用归一化的平均计数<br>$$<br>P_m ;&#x3D;; \frac{c_i + c_{i+1}}{2c_{\max}},<br>$$<br>其中 $c_{\max}$ 是到当前时刻观察到的最大合并计数，用作尺度化。时间距离惩罚 $P_t$ 体现“近因优先保真、远因更可压缩”的原则，记 $t_q$ 为查询或当前时间、$t_i$ 为节点时间，先做归一化距离 $d_i&#x3D;(t_q-t_i)&#x2F;t_q$，再取<br>$$<br>P_t ;&#x3D;; 1 - \frac{d_i + d_{i+1}}{2}.<br>$$<br>权重 $(w_s,w_m,w_t)$ 控制三种策略的相对强度：只开 $P_s$ 会退化为纯相似度合并，只开 $P_t$ 近似 FIFO，只开 $P_m$ 类似均匀下采样；论文默认采用 $0.4&#x2F;0.4&#x2F;0.2$ 的平衡配置。</p>
<p>一旦选定要合并的相邻节点对，系统采用 ToMe 风格的 token 合并把两者的 token 压到原总量的大约一半，同时生成一个新的父节点，作为这两个节点的上层表示。新节点的时间戳按前述加权公式计算，合并计数在子节点的基础上更新（论文不强制具体函数形式，常见做法是对子节点计数做聚合后自增一，以反映“完成一次新合并”）。随后用新节点替换原先的那一对，把它放回到相同的时间位置，继续检查预算；如果仍然超限，就在更新后的“相邻对”集合里再次选择 $P$ 最小的一对继续合并。这个过程保证了森林顶层的根节点数和每个根节点的 token 量都被约束在预算内，同时尽量保留对下游推理最有价值的事件级信息：视觉上高度冗余或时间上久远的部分更可能被合并，而合并次数过多、可能已损失细节的节点会因为 $P_m$ 偏大而被“保护”，避免进一步退化。</p>
<p>从整体上看，PEMF 的“结构—加入—合并”逻辑确保了三件事同时成立：历史被划分成若干时间连续的“树段”，每段内部是自下而上的事件层级；所有段的根节点共同覆盖全部已见历史且不重叠；长期记忆严格受 $L_q$ 约束而不会随视频长度线性膨胀。查询阶段只需取各根节点的表示与 FSTW 的近因细粒度表示拼接，即可在固定预算下把“远因脉络”和“近因征兆”一起交给 LLM 做因果与前瞻推理。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://xmdjy.github.io">xmdjy</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://xmdjy.github.io/2025/10/23/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95/">https://xmdjy.github.io/2025/10/23/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://xmdjy.github.io" target="_blank">xmdjy's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%AE%B0%E5%BD%95/">记录</a></div><div class="post-share"><div class="social-share" data-image="/img/tx.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/10/16/plan/" title="科研计划"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">科研计划</div></div><div class="info-2"><div class="info-item-1">近期需要做的事情：  实验复现：think-then-react的eval和train的代码详细内容(看训练的细节)   动作生成 - THINK-THEN-REACT: TOWARDS UNCONSTRAINED  HUMAN ACTION-TO-REACTION GENERATION 视频理解 - StreamForest: Efficient Online Video Understanding with Persistent Event Memory 视频理解 - Online Video Understanding: OVBench and VideoChat-Online 动作模型 - MotionLLM: Understanding Human Behaviors from Human Motions and Videos 动作理解 - RHINO: Learning Real-Time  Humanoid-Human-Object Interaction  from Human Demonstrations同时关注NJU-MCG组的工作以及RUC-GSAI的相关工...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/tx.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">xmdjy</div><div class="author-info-description">welcome to my blog</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">11</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">2</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xmdjy"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/xmdjy" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:1833299761@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1833299761&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq" style="color: #12b7f5;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">a blog written by xmdjy</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#think-then-react"><span class="toc-number">1.</span> <span class="toc-text">think-then-react</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/23/%E7%A7%91%E7%A0%94%E8%AE%B0%E5%BD%95/" title="科研记录">科研记录</a><time datetime="2025-10-23T11:19:00.000Z" title="发表于 2025-10-23 19:19:00">2025-10-23</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/10/16/plan/" title="科研计划">科研计划</a><time datetime="2025-10-16T11:19:00.000Z" title="发表于 2025-10-16 19:19:00">2025-10-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/17/%E6%95%B0%E7%BB%84/" title="算法详解：二分查找的原理与实现">算法详解：二分查找的原理与实现</a><time datetime="2025-09-17T02:00:00.000Z" title="发表于 2025-09-17 10:00:00">2025-09-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/19/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E7%9A%84%E6%95%B0%E5%AD%A6%E5%8E%9F%E7%90%86/" title="强化学习的数学原理">强化学习的数学原理</a><time datetime="2025-08-18T16:00:00.000Z" title="发表于 2025-08-19 00:00:00">2025-08-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/08/15/hello-world/" title="Hello World">Hello World</a><time datetime="2025-08-15T01:41:21.358Z" title="发表于 2025-08-15 09:41:21">2025-08-15</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 By xmdjy</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.3</a></span></div><div class="footer_custom_text">驱动框架💕 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> | 博客主题✨ <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }

      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>